"use strict";(self.webpackChunkroot=self.webpackChunkroot||[]).push([[799],{76799:function(ze,O,S){S.r(O),S.d(O,{QueryForm:function(){return Te},QueryList:function(){return he},QueryTable:function(){return Ke},QueryToolbar:function(){return Pe},Registry:function(){return g},default:function(){return Ve},openDrawer:function(){return pe},openModal:function(){return ge}});var n=S(62435),N=function(){function a(){this.containers={},this.ctrls={}}return a.prototype.addCtrl=function(e,t){this.ctrls[e]=t},a.prototype.addContainer=function(e,t){this.containers[e]=t},a.prototype.getCtrl=function(e){return this.ctrls[e]},a.prototype.getContainer=function(e){return this.containers[e]},a.DEFAULT_KEY="default",a}(),M=new N,J=function(e){var t=e["x-component"];return n.createElement("div",{className:"dyn-form-ctrl-placeholder"},"\u672A\u5B9E\u73B0\u7684\u7EC4\u4EF6 \u5728\u5B57\u6BB5 ",t)},Z=function(e){return n.createElement("div",{className:"dyn-form-container-placeholder"},e.children)};M.addCtrl(N.DEFAULT_KEY,J),M.addContainer(N.DEFAULT_KEY,Z);var g=M,Ne=function(){function a(e){this.registries=e.concat(M).filter(Boolean)}return a.prototype.getCtrl=function(e,t){t===void 0&&(t=!1);var r;if(e)for(var l=0,o=this.registries;l<o.length;l++){var s=o[l];if(r=s.getCtrl(e),r)break}return r||(t?this.getCtrl(N.DEFAULT_KEY):void 0)},a.prototype.getContainer=function(e,t){t===void 0&&(t=!1);var r;if(e)for(var l=0,o=this.registries;l<o.length;l++){var s=o[l];if(r=s.getContainer(e),r)break}return r||(t?this.getContainer(N.DEFAULT_KEY):void 0)},a}(),c=S(70655),W=S(85667),U=S(99619),P=S(27420),i=S(58049),X=S(23279),$=S.n(X),B={total:0,list:[]},L=n.createContext({query:function(e){return Promise.resolve(B)},refresh:function(){return Promise.resolve(B)},data:B,pageNum:1,pageSize:10,selectedRowKeys:[],handleSetSelectedRowKeys:function(){}});L.displayName="queryList";var G=n.createContext({form:null,responseValue:null,trigger:""}),q=S(87521),Le=S(89295),_=S(30381),Q=S.n(_),ee=function(e,t){return Array.isArray(e)?e.map(function(r){return Q()(r,t)}):e&&Q()(e,t)},te=function(e,t){var r=function(o,s,p){p===void 0&&(p=0);var d=/^(?:[01]\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/,u=s;return Array.isArray(s)&&(u=s[p]),d.test(o)?Q()(o,u).format(u):Q()(o).format(u)};return Array.isArray(e)?e.map(function(l,o){return r(l,t,o)}):e&&r(e,t)},ne=q.Z.RangePicker,j=function(e){},re=function(e){var t=e.deadline,r=e.interval,l=e.value,o=e.onChange,s=o===void 0?j:o,p=(0,c._T)(e,["deadline","interval","value","onChange"]),d=(0,n.useState)(null),u=d[0],C=d[1],f=(0,n.useState)(function(){return l}),R=f[0],h=f[1];(0,n.useEffect)(function(){h(l)},[l]);var m=function(y){var w=y&&y>t;if(!u)return t?w:!1;if(r){var D=u[0]&&y.diff(u[0],"days")>r,x=u[1]&&u[1].diff(y,"days")>r;return!!x||!!D||(t?w:!1)}return t?w:!1},v=function(y){C(y?[null,null]:null)},E=function(y){return h(y),typeof s=="function"?s(y):j(y)};return n.createElement(ne,(0,c.pi)({value:u||R,disabledDate:m,onCalendarChange:function(y){return C(y)},onChange:E,onOpenChange:v},p))},ae=(0,P.$j)(re,(0,P.jM)(function(a){var e=function(o){return o.showTime?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD"},t=a.onChange,r=a.format||e(a);return(0,c.pi)((0,c.pi)({},a),{format:a.format,value:ee(a.value,r),onChange:function(o){t&&t(te(o,r))}})})),oe=ae;g.addCtrl("FormLayout",i.lt),g.addCtrl("FormItem",i.xJ),g.addCtrl("FormGrid",i.T5),g.addCtrl("Space",i.T),g.addCtrl("Submit",i.k4),g.addCtrl("Reset",i.AG),g.addCtrl("Input",i.II),g.addCtrl("Password",i.ro),g.addCtrl("Select",i.Ph),g.addCtrl("TreeSelect",i.mP),g.addCtrl("DatePicker",i.Mt),g.addCtrl("TimePicker",i.jI),g.addCtrl("NumberPicker",i.Ye),g.addCtrl("Transfer",i.FE),g.addCtrl("Cascader",i.vT),g.addCtrl("Checkbox",i.XZ),g.addCtrl("Radio",i.Y8),g.addCtrl("Upload",i.gq),g.addCtrl("Switch",i.rs),g.addCtrl("ArrayItems",i.sz),g.addCtrl("RangePickerWithDisabledDate",oe);var ie=g,le=function(e){return e.split(".")[0]},H=function(e){return e["x-decorator"]?[e["x-decorator"],e["x-component"]]:e["x-component"]||[]},ue=function a(e){return Object.values((e==null?void 0:e.properties)||{}).reduce(function(t,r){return t.push(H(r)),r.items&&(t.push(H(r.items)),t.push(a(r.items))),r.properties&&t.push(a(r)),t},[])},Y=function(e){if(e!=null&&e.properties)return ue(e).flat(1/0).filter(Boolean).reduce(function(t,r){var l=le(r);return t[l]||(t[l]=ie.getCtrl(l)),t},{})},Me=function(e){return typeof e=="function"},se={layout:"horizontal"},ce=10,fe={title:"\u5F39\u7A97",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88"},de={title:"\u62BD\u5C49"},me=function(e){var t=e.schema,r=e.formConfig,l=r===void 0?{}:r,o=e.children,s=e.scope,p=e.initialValues,d=e.trigger,u=d===void 0?"onSubmit":d,C=(0,n.useState)(null),f=C[0],R=C[1],h=(0,n.useMemo)(function(){return(0,U.Np)((0,c.pi)({validateFirst:!0},u==="onChange"?{effects:function(){(0,U.pO)($()(function(E){R((0,W.ZN)(E.values))},300))}}:null))},[u]);(0,n.useEffect)(function(){p&&h.setInitialValues(p)},[p]);var m=(0,n.useMemo)(function(){if(!t)return null;var v=Y(t);console.log(v,"components");var E=(0,P.cA)({components:v});return n.createElement(i.lt,(0,c.pi)({},l),n.createElement(E,{schema:t,scope:s}))},[t,s]);return n.createElement(G.Provider,{value:{form:h,responseValue:f,trigger:u}},n.createElement(P.RV,{form:h},m,o))},ve=me,ge=function(e){var t=e.title,r=e.schema,l=e.formConfig,o=l===void 0?{}:l,s=e.initialValues,p=s===void 0?{}:s,d=e.onConfirm,u=e.onCancel,C=Y(r),f=(0,P.cA)({components:C}),R=(0,c.pi)((0,c.pi)({},fe),typeof t=="string"?{title:t}:t),h=(0,i.D_)(R,function(){return n.createElement(i.lt,(0,c.pi)({},o),n.createElement(f,{schema:r}))});h.forOpen(function(m,v){v({initialValues:p})}).forConfirm(function(m,v){var E=m.getState().values;d(E).then(function(){return v(m)})}).forCancel(function(m,v){u&&u(),v(m)}).open()},pe=function(e){var t=e.title,r=e.schema,l=e.formConfig,o=l===void 0?{}:l,s=e.initialValues,p=s===void 0?{}:s,d=e.onConfirm,u=e.onCancel,C=Y(r),f=(0,P.cA)({components:C}),R=(0,c.pi)((0,c.pi)({},de),typeof t=="string"?{title:t}:t),h=(0,i._8)(R,function(){var m=typeof d=="function";return n.createElement(i.lt,(0,c.pi)({},o),n.createElement(f,{schema:r}),m?n.createElement(i._8.Extra,null,n.createElement(i.d5,{align:"right"},n.createElement(i.AG,{onClick:function(){return h.close()}},"\u53D6\u6D88"),n.createElement(i.k4,{onSubmit:function(E){return d(E)}},"\u63D0\u4EA4"))):null)});h.open({initialValues:p})},Ce=function(e){var t=e.service,r=e.pageSize,l=r===void 0?ce:r,o=e.children,s=(0,n.useContext)(G).form,p=(0,n.useState)({list:[],total:0}),d=p[0],u=p[1],C=(0,n.useState)({pageNum:1,pageSize:l}),f=C[0],R=C[1],h=(0,n.useState)([]),m=h[0],v=h[1],E=function(D){return(0,c.mG)(void 0,void 0,void 0,function(){var x,F;return(0,c.Jh)(this,function(V){switch(V.label){case 0:return x=(0,c.pi)({pageNum:1,pageSize:l},D),[4,t(x)];case 1:return F=V.sent(),R({pageNum:x.pageNum,pageSize:x.pageSize}),u(F),[2,F]}})})},T=(0,n.useCallback)(function(){return(0,c.mG)(void 0,void 0,void 0,function(){var w,D,x;return(0,c.Jh)(this,function(F){switch(F.label){case 0:return w=s.getState().values,D=(0,c.pi)((0,c.pi)({},w),{pageNum:f.pageNum,pageSize:f.pageSize}),[4,t(D)];case 1:return x=F.sent(),u(x),[2,x]}})})},[s,t,f]),y=(0,n.useCallback)(function(w){v(w)},[]);return n.createElement(L.Provider,{value:{query:function(D){return E(D)},data:d,pageNum:f.pageNum,pageSize:f.pageSize,refresh:T,selectedRowKeys:m,handleSetSelectedRowKeys:y}},n.createElement("div",null,typeof o=="function"?o({refresh:T}):o))},he=Ce,ye=S(18446),Ee=S.n(ye),Se=function(e,t){return Ee()(e,t)},Re=function(e){var t=(0,n.useRef)(),r=(0,n.useRef)(0);return(e===void 0||!Se(e,t.current))&&(t.current=e,r.current+=1),r.current},we=Re,De=function(e,t){t===void 0&&(t={});var r=(0,n.useReducer)(function(f){return f+1},0),l=r[1],o=(0,n.useMemo)(function(){var f={maxColumns:4,maxWidth:240,maxRows:e,shouldVisible:function(m,v){return m.index===v.childSize-1||v.maxRows===1/0?!0:m.shadowRow<e+1}},R=Object.assign(f,t);return i.T5.createFormGrid(R)},[we(t)]),s=o.maxRows===1/0,p=o.shadowRows,d=o.fullnessLastColumn?o.shadowRows-1:o.shadowRows,u=function(){o.maxRows===1/0?o.maxRows=e:o.maxRows=1/0,l()},C=function(){return p<e+1?"incomplete-wrap":d>e?"collapsible":"complete-wrap"};return{grid:o,expanded:s,toggle:u,type:C()}},xe=De,be=function(e){var t=e.schema,r=e.scope,l=r===void 0?{}:r,o=e.formConfig,s=o===void 0?se:o,p=e.gridConfig,d=p===void 0?{minColumns:4}:p,u=e.rows,C=u===void 0?2:u,f=(0,n.useContext)(G),R=f.form,h=f.trigger,m=f.responseValue,v=(0,n.useContext)(L).query,E=xe(C,d),T=E.grid,y=E.expanded,w=E.toggle,D=E.type,x=(0,n.useMemo)(function(){return h==="onChange"&&D==="incomplete-wrap"},[h,D]);(0,n.useEffect)(function(){x&&m!==null&&v(m)},[m,x]);var F=function(K){v(K)},V=Y(t),k=(0,P.cA)({components:V,scope:l}),A=(0,n.useCallback)(function(){var b=function(){return n.createElement(n.Fragment,null,n.createElement(i.k4,null,"\u67E5\u8BE2"),n.createElement(i.AG,null,"\u91CD\u7F6E"))};return D==="incomplete-wrap"?n.createElement(i.d5.FormItem,null,n.createElement(i.d5,null,b())):D==="collapsible"?n.createElement(n.Fragment,null,n.createElement(i.d5,null,b()),n.createElement(i.d5,{align:"right"},n.createElement("a",{onClick:function(I){I.preventDefault(),w()}},y?"\u6536\u8D77":"\u5C55\u5F00"))):n.createElement(i.d5,{align:"right",style:{display:"flex",width:"100%"}},b())},[D,y,w]);return n.createElement(i.l0,(0,c.pi)({form:R},s,{onAutoSubmit:F}),n.createElement(i.T5,{grid:T},n.createElement(k,{schema:t}),x?null:n.createElement(i.T5.GridColumn,{gridSpan:-1,style:{display:"flex",justifyContent:"space-between",marginBottom:"22px"}},A())))},Te=be,Fe=S(46376),Ge=S(10373),Ae=function(e){var t=e.columns,r=e.mode,l=e.primaryKey,o=l===void 0?"key":l,s=(0,c._T)(e,["columns","mode","primaryKey"]),p=(0,n.useContext)(G).form,d=(0,n.useContext)(L),u=d.query,C=d.data,f=d.pageNum,R=d.pageSize,h=d.refresh,m=d.selectedRowKeys,v=d.handleSetSelectedRowKeys,E=(0,n.useState)(!1),T=E[0],y=E[1],w=function(A,b){return(0,c.mG)(void 0,void 0,void 0,function(){var K,I;return(0,c.Jh)(this,function(z){switch(z.label){case 0:K=p.getState().values,I=(0,c.pi)({pageNum:A,pageSize:b},K),z.label=1;case 1:return z.trys.push([1,,3,4]),y(!0),[4,u(I)];case 2:return z.sent(),[3,4];case 3:return y(!1),[7];case 4:return[2]}})})};(0,n.useEffect)(function(){w(f,R)},[]);var D={current:f,pageSize:R,showQuickJumper:!0,showTotal:function(A,b){return"\u5171".concat(A,"\u6761")},total:C.total,onChange:function(A,b){w(A,b)}},x=function(){return{type:r,selectedRowKeys:m,onChange:function(b){v(b)}}},F=function(A){return{onClick:function(){var K=A[o],I=m,z=m.indexOf(K);z==-1?I=(0,c.ev)((0,c.ev)([],m,!0),[K],!1):I=m.filter(function(ke){return ke!==K}),v(I)}}},V=t({refresh:h});return n.createElement(Fe.Z,(0,c.pi)({columns:V,dataSource:C.list,loading:T,pagination:D,rowSelection:r?x():null,onRow:r?F:null},s))},Ke=Ae;function Ie(a){var e=a.children,t=(0,n.useContext)(L),r=t.refresh,l=t.selectedRowKeys;return n.createElement("div",null,typeof e=="function"?e({refresh:r,selectedRowKeys:l}):e)}var Pe=Ie,Ve=ve}}]);
